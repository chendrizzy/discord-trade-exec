# Analytics Dashboard Admin Guide

## Overview

The Business Analytics Dashboard provides comprehensive revenue metrics, churn prediction, and cohort retention analysis for administrators. This guide covers how to access, navigate, and interpret the analytics dashboard.

**Dashboard Location**: `/dashboard/analytics` (admin access required)

**Primary Use Cases**:
- Monitor subscription revenue (MRR, ARR, LTV)
- Identify at-risk customers before they churn
- Track cohort retention trends over time
- Make data-driven decisions on retention campaigns

---

## Prerequisites

### Access Requirements

**Admin Role Required**: The analytics dashboard is restricted to admin users only.

**Authentication Check**:
```javascript
// Middleware: ensureAdmin
// Location: src/middleware/auth.js
// Validates: req.user.role === 'admin'
```

**If you see "Unauthorized access"**:
1. Verify your user account has `role: 'admin'` in MongoDB
2. Check session cookie is valid
3. Ensure you're logged in with admin credentials

### Database Requirements

**Minimum Data for Meaningful Analytics**:
- **Revenue Metrics**: At least 5 active subscriptions
- **Churn Analysis**: 30 days of historical subscription data
- **Cohort Analysis**: 2+ cohorts (monthly cohorts recommended)

**First-Time Setup**: If dashboard shows "No data available", ensure:
- Users have active subscriptions (status: `active` or `trial`)
- Stripe webhooks are properly configured
- MongoDB has at least 30 days of user activity

---

## Dashboard Components

### 1. Revenue Metrics Overview

**Component**: `RevenueMetricsChart`
**Location**: Top section of dashboard

#### Metrics Displayed

| Metric | Description | Calculation | Interpretation |
|--------|-------------|-------------|----------------|
| **MRR** | Monthly Recurring Revenue | Sum of all active subscription prices | Current monthly revenue |
| **ARR** | Annual Recurring Revenue | MRR √ó 12 | Projected annual revenue |
| **LTV** | Customer Lifetime Value | ARPU √ó Avg. Lifetime (months) | Value per customer |
| **ARPU** | Average Revenue Per User | MRR √∑ Active Subscribers | Revenue efficiency |
| **Churn Rate** | Monthly cancellation rate | Canceled √∑ Total Subscribers | Customer retention health |

#### Visual Elements

**Chart Type**: Line chart with trend lines

**Time Period**: Last 12 months (default)

**Color Coding**:
- üü¢ Green: Positive growth (MRR increasing)
- üî¥ Red: Negative trend (MRR declining)
- üü° Yellow: Stable (¬±2% variance)

#### How to Read the Chart

**Healthy SaaS Metrics**:
- MRR growth: >5% month-over-month
- Churn rate: <5% per month
- LTV:CAC ratio: >3:1 (see CAC in separate section)

**Warning Signs**:
- MRR declining 2+ consecutive months ‚Üí investigate cancellations
- Churn rate >8% ‚Üí review at-risk users (see Churn Risk section)
- ARPU declining ‚Üí users downgrading plans

**Example Interpretation**:
```
MRR: $14,500 (+8.5% vs last month) ‚úÖ Healthy growth
Churn: 4% ‚úÖ Below 5% threshold
LTV: $2,320 ‚ö†Ô∏è Monitor if drops below $2,000
```

---

### 2. Churn Risk List

**Component**: `ChurnRiskList`
**Location**: Middle section, left panel

#### Purpose

Identifies users at risk of canceling their subscription based on behavioral signals.

#### Risk Scoring Algorithm

**Risk Score = Weighted Sum of 5 Factors** (0-100 scale):

| Factor | Weight | What It Measures | High Risk Threshold |
|--------|--------|------------------|---------------------|
| **Inactivity** | 35% | Days since last trade | >14 days |
| **Win Rate** | 25% | Trading success % | <40% |
| **Login Frequency** | 20% | Days since last login | >7 days |
| **Support Issues** | 10% | Number of tickets | >3 tickets |
| **Profitability** | 10% | Total P&L | Negative P&L |

**Risk Levels**:
- üö® **Critical** (80-100): Immediate intervention required
- üî¥ **High** (60-79): Proactive outreach needed
- üü° **Medium** (40-59): Monitor closely
- üü¢ **Low** (0-39): Healthy customer

#### How to Use the Churn Risk List

**Step 1: Filter by Risk Level**

```javascript
// Click filter dropdown
‚Üí Select "Critical" or "High"
‚Üí View only actionable at-risk users
```

**Step 2: Review User Details**

Each at-risk user card shows:
- **User Info**: Username, email, Discord ID
- **Risk Score**: 78.5 (High)
- **Risk Factors**: `["inactive_14_days", "low_win_rate", "no_recent_login"]`
- **Subscription**: Tier (Basic, Pro, Premium), MRR ($49.00)
- **Recommendations**: AI-generated retention actions

**Step 3: Take Action**

**Automated Recommendations** (generated by ChurnPredictor):
- "Send personalized retention email with win rate improvement tips"
- "Offer free strategy consultation call"
- "Provide educational content on risk management"

**Manual Actions**:
1. Click "View User Profile" ‚Üí Open user details
2. Review trade history ‚Üí Identify pain points
3. Send targeted retention offer (discount, premium trial, etc.)
4. Schedule 1-on-1 support call

#### Churn Risk Metrics Summary

**Top Right Corner Stats**:
- **Total At-Risk**: 45 users
- **Critical**: 8 users (prioritize these first)
- **Total MRR at Risk**: $4,350 (potential revenue loss if all churn)

**Prioritization Strategy**:
1. Critical users with high MRR first ($299/month Premium)
2. High-risk users approaching renewal date
3. Users with recent negative P&L spikes

---

### 3. Cohort Retention Table

**Component**: `CohortRetentionTable`
**Location**: Bottom section, full width

#### Purpose

Visualizes customer retention over time by cohort (signup month).

#### Understanding the Cohort Table

**Table Structure**:
```
Cohort    | M0   | M1   | M2   | M3   | M6   | M12
---------|------|------|------|------|------|------
2024-10  | 100% | 88%  | 75%  | 68%  | ?    | ?
2024-09  | 100% | 84%  | 71%  | 65%  | 52%  | ?
2024-08  | 100% | 82%  | 69%  | 62%  | 48%  | 38%
```

**Column Definitions**:
- **Cohort**: Signup month (e.g., 2024-10 = October 2024 signups)
- **M0**: Initial month (always 100%)
- **M1-M12**: Retention % after N months

#### Color Coding

**Heat Map Colors**:
- üü¢ **Green** (80-100%): Excellent retention
- üü° **Yellow** (60-79%): Acceptable retention
- üü† **Orange** (40-59%): Needs improvement
- üî¥ **Red** (<40%): Critical retention issue

#### Key Metrics to Track

**1. Month 1 Retention (M1)**
- **Industry Benchmark**: 70-80% for SaaS
- **Your Target**: >80%
- **If Below 70%**: Improve onboarding experience

**2. Month 3 Retention (M3)**
- **Industry Benchmark**: 60-70%
- **Your Target**: >65%
- **If Below 60%**: Review product-market fit

**3. Month 12 Retention (M12)**
- **Industry Benchmark**: 40-50% for trading SaaS
- **Your Target**: >45%
- **If Below 40%**: Investigate long-term value proposition

#### Trend Analysis

**Cohort Comparison Feature**:

Click "Compare Cohorts" button ‚Üí Select 2-3 cohorts ‚Üí View trend

**Trend Types**:
- üìà **Improving**: Newer cohorts show better retention
  - Example: Oct 2024 M1 = 88% vs Sep 2024 M1 = 84%
  - **Action**: Document what's working, scale it

- üìâ **Declining**: Newer cohorts show worse retention
  - Example: Oct 2024 M1 = 82% vs Sep 2024 M1 = 88%
  - **Action**: Investigate recent product changes

- ‚û°Ô∏è **Stable**: No significant change between cohorts
  - **Action**: Focus on experimentation to improve

#### Metric Selection

**Toggle Retention Metric** (top right dropdown):

1. **Active** (default): User logged in OR traded
   - Most forgiving metric
   - Best for overall health check

2. **Trade**: User executed at least one trade
   - Strictest engagement metric
   - Best for product usage analysis

3. **Login**: User logged into platform
   - Middle ground metric
   - Best for activation analysis

**When to Use Each Metric**:
- **Active**: Monthly business reviews
- **Trade**: Product team sprint planning
- **Login**: Activation campaign effectiveness

---

## Common Workflows

### Workflow 1: Monthly Business Review

**Objective**: Assess overall business health

**Steps**:
1. Open Analytics Dashboard
2. Review Revenue Metrics:
   - Check MRR growth vs last month
   - Verify churn rate <5%
   - Calculate LTV:CAC ratio (if CAC available)
3. Scan Churn Risk Summary:
   - Note total at-risk users
   - Check MRR at risk
4. Review Cohort Retention:
   - Compare last 3 cohorts
   - Identify retention trends
5. Generate report (Export ‚Üí CSV or Screenshot)

**Time Required**: 10-15 minutes

---

### Workflow 2: Proactive Churn Prevention

**Objective**: Reduce churn before it happens

**Steps**:
1. Navigate to Churn Risk List
2. Filter by "Critical" risk level
3. Sort by "MRR" (highest first)
4. For top 5 critical users:
   - Review risk factors
   - Check trade history
   - Identify pain points
   - Send personalized retention email
   - Offer solution (education, support, discount)
5. Schedule follow-up in CRM (7 days)
6. Move to "High" risk level users
7. Repeat process weekly

**Time Required**: 30-45 minutes weekly

**Expected ROI**: 20-40% reduction in monthly churn

---

### Workflow 3: Cohort Performance Analysis

**Objective**: Understand what drives retention

**Steps**:
1. Open Cohort Retention Table
2. Select "Trade" metric (strictest)
3. Compare newest cohort vs 3-month-old cohort
4. If newer cohort retention is better:
   - Document recent product changes
   - Interview new users (NPS survey)
   - Scale successful features
5. If newer cohort retention is worse:
   - Review recent releases
   - Check for introduced bugs
   - Analyze user feedback
6. Toggle to "Login" metric
7. Identify drop-off points (M1 vs M3 vs M6)
8. Create targeted re-engagement campaigns

**Time Required**: 1-2 hours monthly

---

### Workflow 4: Retention Campaign Validation

**Objective**: Measure effectiveness of retention campaigns

**Steps**:
1. Before launching campaign:
   - Note current churn rate
   - Document at-risk user count
   - Record MRR at risk
2. Launch retention campaign (email, in-app, discount)
3. Wait 14 days
4. Return to dashboard:
   - Compare churn rate (before vs after)
   - Check at-risk user count change
   - Calculate saved MRR (at-risk MRR reduction)
5. If improvement >10%:
   - Document campaign details
   - Add to playbook
   - Repeat quarterly
6. If improvement <10%:
   - Analyze campaign performance
   - A/B test different approaches

**Time Required**: 30 minutes (initial), 30 minutes (follow-up)

---

## Navigation Guide

### Accessing the Dashboard

**URL**: `https://your-domain.com/dashboard/analytics`

**Login Flow**:
1. Navigate to login page
2. Authenticate with admin credentials
3. Verify admin role in session
4. Dashboard automatically loads

**Keyboard Shortcuts**:
- `Ctrl/Cmd + R`: Refresh data
- `Ctrl/Cmd + E`: Export CSV
- `Tab`: Navigate between sections
- `?`: Show help overlay (if implemented)

### Page Layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Header: Analytics Dashboard                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                ‚îÇ
‚îÇ  üìä Revenue Metrics Chart (12 months)         ‚îÇ
‚îÇ  [MRR] [ARR] [LTV] [ARPU] [Churn Rate]       ‚îÇ
‚îÇ                                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                      ‚îÇ                         ‚îÇ
‚îÇ  üö® Churn Risk List  ‚îÇ  üìà Quick Stats         ‚îÇ
‚îÇ  [Filter] [Sort]     ‚îÇ  ‚Ä¢ Active Users         ‚îÇ
‚îÇ                      ‚îÇ  ‚Ä¢ New This Month       ‚îÇ
‚îÇ  [User cards...]     ‚îÇ  ‚Ä¢ Churned This Month   ‚îÇ
‚îÇ                      ‚îÇ                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                ‚îÇ
‚îÇ  üìÖ Cohort Retention Table                    ‚îÇ
‚îÇ  [Metric: Active ‚ñº] [Period: Monthly ‚ñº]      ‚îÇ
‚îÇ  [Compare Cohorts]                            ‚îÇ
‚îÇ                                                ‚îÇ
‚îÇ  [Heat map table...]                          ‚îÇ
‚îÇ                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Metric Interpretation

### Revenue Metrics

#### MRR (Monthly Recurring Revenue)

**What It Means**: Total recurring revenue from all active subscriptions

**Calculation**:
```javascript
MRR = Œ£ (active_subscriptions.price)
```

**Example**:
```
50 Basic users √ó $49 = $2,450
30 Pro users √ó $99 = $2,970
15 Premium users √ó $299 = $4,485
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total MRR = $9,905
```

**Healthy Growth Rate**: 5-10% month-over-month

**Red Flags**:
- MRR declining 2+ consecutive months
- New MRR < Churned MRR (negative net revenue)
- MRR growth rate slowing (e.g., 10% ‚Üí 5% ‚Üí 2%)

---

#### ARR (Annual Recurring Revenue)

**What It Means**: Projected annual revenue based on current MRR

**Calculation**:
```javascript
ARR = MRR √ó 12
```

**Use Cases**:
- Investor reporting
- Annual budget planning
- Valuation calculations (typically 5-10x ARR)

**Note**: ARR assumes no churn, so always factor in churn rate for realistic projections

---

#### LTV (Customer Lifetime Value)

**What It Means**: Total revenue expected from a customer over their lifetime

**Calculation**:
```javascript
LTV = ARPU √ó Average_Lifetime_Months
LTV = ARPU √ó (1 √∑ Churn_Rate)
```

**Example**:
```
ARPU = $96.67
Churn Rate = 4% (0.04)
Average Lifetime = 1 √∑ 0.04 = 25 months

LTV = $96.67 √ó 25 = $2,416.75
```

**Industry Benchmarks**:
- **Trading SaaS**: $1,500-$3,000
- **General SaaS**: $2,000-$5,000

**Critical Ratio**: LTV:CAC should be >3:1
- If LTV:CAC <3:1 ‚Üí Reduce CAC or increase LTV (upsells, reduce churn)

---

#### Churn Rate

**What It Means**: Percentage of customers who canceled in a given period

**Calculation**:
```javascript
Churn_Rate = (Canceled_Subscriptions √∑ Total_Subscriptions_Start) √ó 100
```

**Example**:
```
Start of month: 150 subscribers
Canceled: 6 subscribers
Churn Rate = (6 √∑ 150) √ó 100 = 4%
```

**Industry Benchmarks**:
- **Excellent**: <3%
- **Good**: 3-5%
- **Acceptable**: 5-7%
- **Poor**: >7%

**Retention Rate** (inverse of churn):
```javascript
Retention_Rate = 100% - Churn_Rate
```

---

### Churn Risk Score Interpretation

#### Risk Factor Breakdown

**Example Risk Calculation**:
```javascript
User: trader_mike
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Inactivity:        27.3 points (35% weight)
  ‚Üí 18 days since last trade
  ‚Üí Score = (18 √∑ 30) √ó 35 = 21 points
  ‚Üí Bonus = 6.3 points (>14 days)

Win Rate:          19.6 points (25% weight)
  ‚Üí 38% win rate (target: 50%)
  ‚Üí Score = (1 - 0.38) √ó 25 = 15.5 points
  ‚Üí Bonus = 4.1 points (<40%)

Login Frequency:   15.7 points (20% weight)
  ‚Üí 9 days since login
  ‚Üí Score = (9 √∑ 14) √ó 20 = 12.9 points
  ‚Üí Bonus = 2.8 points (>7 days)

Support Issues:    8.2 points (10% weight)
  ‚Üí 5 support tickets
  ‚Üí Score = (5 √∑ 3) √ó 10 = 16.7 points (capped at 10)
  ‚Üí Penalty = -1.8 points adjustment

Profitability:     7.7 points (10% weight)
  ‚Üí -$450 P&L
  ‚Üí Score = 10 points (negative P&L)
  ‚Üí Penalty = -2.3 points (modest loss)

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Risk Score:  78.5 (HIGH RISK)
```

#### Recommended Actions by Risk Level

**Critical (80-100)**:
- ‚è∞ **Urgency**: Contact within 24 hours
- üìû **Method**: Phone call or urgent email
- üí∞ **Offer**: Aggressive retention (50% discount, free consultation)
- üéØ **Goal**: Prevent immediate cancellation

**High (60-79)**:
- ‚è∞ **Urgency**: Contact within 3 days
- üìß **Method**: Personalized email with actionable tips
- üéÅ **Offer**: Value-add (premium trial, educational content)
- üéØ **Goal**: Re-engage before next billing cycle

**Medium (40-59)**:
- ‚è∞ **Urgency**: Monitor weekly
- üì® **Method**: Automated re-engagement email
- üìö **Offer**: Educational resources, feature highlights
- üéØ **Goal**: Increase engagement before risk escalates

**Low (0-39)**:
- ‚è∞ **Urgency**: Monthly check-in
- üéâ **Method**: Success stories, NPS survey
- üöÄ **Offer**: Upsell opportunities
- üéØ **Goal**: Identify expansion revenue potential

---

## Data Refresh

### Automatic Refresh

**Real-Time Updates**: Event-driven updates (WebSocket)
- New subscription ‚Üí Revenue metrics update
- User cancellation ‚Üí Churn risk list updates
- Trade execution ‚Üí Cohort activity updates

**Batch Updates**: Every 30 seconds
- Metrics aggregation
- Risk score recalculation
- Cohort retention refresh

### Manual Refresh

**Force Refresh Button**: Top right corner

**When to Use**:
- After Stripe webhook processing
- After bulk user imports
- If data appears stale (>5 minutes old)

**Refresh Shortcut**: `Ctrl/Cmd + R`

---

## Troubleshooting

### Issue 1: "No data available"

**Possible Causes**:
1. No active subscriptions in database
2. MongoDB connection issue
3. Admin role not properly set

**Solutions**:
1. Check MongoDB for users with `subscription.status: "active"`
2. Verify `MONGODB_URI` in environment variables
3. Confirm user has `role: "admin"` in database

---

### Issue 2: Revenue metrics show $0

**Possible Causes**:
1. Stripe webhooks not processing
2. `subscription.currentPeriodEnd` dates expired
3. Database query filtering out active subscriptions

**Solutions**:
1. Check Stripe webhook logs: `stripe logs tail`
2. Verify subscription dates: `db.users.find({"subscription.status": "active"})`
3. Test `/api/analytics/revenue` endpoint directly

---

### Issue 3: Churn risk list is empty

**Possible Causes**:
1. All users have low risk scores (<40)
2. ChurnPredictor service not running
3. Insufficient user activity data

**Solutions**:
1. Lower risk threshold: Filter by "Medium" risk
2. Check service logs: `grep "ChurnPredictor" logs/app.log`
3. Ensure users have at least 7 days of activity

---

### Issue 4: Cohort table shows blanks

**Possible Causes**:
1. Insufficient cohort data (need 2+ cohorts)
2. Users missing `createdAt` timestamps
3. Retention metric calculation error

**Solutions**:
1. Wait for at least 2 monthly cohorts to form
2. Check `db.users.find({createdAt: {$exists: false}})`
3. Test `/api/analytics/cohorts/retention` endpoint

---

### Issue 5: Dashboard loading slowly

**Possible Causes**:
1. Large dataset (>1000 users)
2. No MongoDB indexes
3. Cache not enabled

**Solutions**:
1. Enable pagination: Modify `CohortRetentionTable` to paginate
2. Create indexes: `db.users.createIndex({"subscription.status": 1})`
3. Enable Redis caching (see Performance Optimization section)

---

## Performance Optimization

### Caching Strategy

**Revenue Metrics**: 5-minute cache
```javascript
// Cache key: `analytics:revenue:${date}`
// TTL: 300 seconds
```

**Churn Risks**: 10-minute cache
```javascript
// Cache key: `analytics:churn_risks:${riskLevel}`
// TTL: 600 seconds
```

**Cohort Data**: 30-minute cache
```javascript
// Cache key: `analytics:cohorts:${period}:${metric}`
// TTL: 1800 seconds
```

### MongoDB Optimization

**Required Indexes**:
```javascript
db.users.createIndex({"subscription.status": 1})
db.users.createIndex({"subscription.tier": 1})
db.users.createIndex({"createdAt": 1})
db.trades.createIndex({"userId": 1, "createdAt": -1})
```

**Aggregation Pipeline Optimization**:
- Use `$match` early in pipeline
- Limit results with `$limit` before `$sort`
- Project only required fields with `$project`

---

## Security Considerations

### Access Control

**Middleware Enforcement**:
```javascript
// All analytics routes protected by ensureAdmin
router.get('/api/analytics/*', ensureAdmin, analyticsController)
```

**Admin Role Check**:
```javascript
if (req.user.role !== 'admin') {
  return res.status(403).json({ error: 'Admin access required' })
}
```

### Data Privacy

**PII Handling**:
- Email addresses hashed in logs
- Full user data only visible to admins
- Churn risk factors anonymized in exports

**Audit Logging**:
```javascript
// All analytics queries logged
logger.info('Analytics query', {
  userId: req.user.id,
  endpoint: req.path,
  timestamp: new Date()
})
```

---

## Best Practices

### Daily Checklist

- [ ] Review MRR growth vs yesterday
- [ ] Check critical churn risk count
- [ ] Respond to 3+ critical risk users
- [ ] Monitor latest cohort M1 retention

### Weekly Checklist

- [ ] Analyze churn risk trends
- [ ] Compare last 2 cohorts
- [ ] Export retention data for team meeting
- [ ] Update retention campaign based on data

### Monthly Checklist

- [ ] Full business health review
- [ ] Cohort performance analysis
- [ ] LTV:CAC ratio calculation
- [ ] Retention campaign effectiveness report

---

## Support

### Getting Help

**Internal Documentation**:
- API Reference: `docs/ANALYTICS_API.md`
- Churn Algorithm: `docs/CHURN_PREDICTION_ALGORITHM.md`
- Cohort Analysis: `docs/COHORT_ANALYSIS_GUIDE.md`

**Technical Support**:
- GitHub Issues: File bug reports or feature requests
- Developer Slack: #analytics-dashboard channel

### Reporting Issues

**Include in Bug Reports**:
1. Screenshot of dashboard
2. Browser console errors
3. User role and permissions
4. Expected vs actual behavior
5. Steps to reproduce

---

## Glossary

| Term | Definition |
|------|------------|
| **MRR** | Monthly Recurring Revenue |
| **ARR** | Annual Recurring Revenue (MRR √ó 12) |
| **LTV** | Customer Lifetime Value |
| **CAC** | Customer Acquisition Cost |
| **ARPU** | Average Revenue Per User |
| **Churn** | Rate of customer cancellations |
| **Cohort** | Group of users who signed up in the same period |
| **Retention** | Percentage of users still active after N months |
| **At-Risk** | Users with high churn probability |
| **Risk Score** | Weighted prediction of churn likelihood (0-100) |

---

**Last Updated**: 2025-10-16
**Version**: 1.0
**Next Review**: Phase 5 (Advanced Features) completion
